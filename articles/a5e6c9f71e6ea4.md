---
title: "ã€FlutterÃ—Firebaseã€‘Cloud Firestoreã‚¯ã‚¨ãƒªä¸€è¦§"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter", "Firebase", "Firestore"]
published: true
---

# whereï¼ˆç‰¹å®šã®æ¡ä»¶ã§æŠ½å‡ºã™ã‚‹ï¼‰

| æ¼”ç®—å­                   | æ„å‘³                               | ä½¿ã„æ–¹                                                    |
| ------------------------ | ---------------------------------- | --------------------------------------------------------- |
| `isEqualTo`              | ã€œã¨ç­‰ã—ã„                         | `.where('name', isEqualTo: 'å±±ç”°å¤ªéƒ')`                   |
| `isNotEqualTo`           | ã€œã¨ç­‰ã—ããªã„                     | `.where('name', isNotEqualTo: 'å±±ç”°å¤ªéƒ')`                |
| `isLessThan`             | ã€œã‚ˆã‚Šå°ã•ã„                       | `.where('age', isLessThan: 20)`                           |
| `isLessThanOrEqualTo`    | ã€œä»¥ä¸‹                             | `.where('age', isLessThanOrEqualTo: 20)`                  |
| `isGreaterThan`          | ã€œã‚ˆã‚Šå¤§ãã„                       | `.where('age', isGreaterThan: 20)`                        |
| `isGreaterThanOrEqualTo` | ã€œä»¥ä¸Š                             | `.where('age', isGreaterThanOrEqualTo: 20)`               |
| `arrayContains`          | é…åˆ—å†…ã«å³è¾ºã®è¦ç´ ã‚’å«ã‚€           | `.where('hobbies', arrayContains: 'é‡£ã‚Š')`                |
| `arrayContainsAny`       | é…åˆ—å†…ã«å³è¾ºã®è¦ç´ ã®ã„ãšã‚Œã‹ã‚’å«ã‚€ | `.where('hobbies', arrayContainsAny: ['é‡£ã‚Š', 'ã‚®ã‚¿ãƒ¼'])` |
| `whereIn`                | å³è¾ºã®ã„ãšã‚Œã‹ãŒå«ã¾ã‚Œã¦ã„ã‚‹       | `.where('name', whereIn: ['å±±ç”°å¤ªéƒ', 'å±±ç”°èŠ±å­'])`       |
| `whereNotIn`             | å³è¾ºã®ã„ãšã‚Œã‚‚å«ã¾ã‚Œãªã„           | `.where('name', whereNotIn: ['å±±ç”°å¤ªéƒ', 'å±±ç”°èŠ±å­'])`    |
| `isNull`                 | å³è¾ºãŒ null ã§ã‚ã‚‹ãƒ»ãªã„           | `.where('name', isNull: true)`                            |

## isEqualToï¼ˆã€œã¨ç­‰ã—ã„ï¼‰

```dart:ã€Œnameã€ ãŒ ã€Œå±±ç”°å¤ªéƒã€ ã§ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('name', isEqualTo: 'å±±ç”°å¤ªéƒ').get();
```

## isNotEqualToï¼ˆã€œã¨ç­‰ã—ããªã„ï¼‰

```dart:ã€Œnameã€ ãŒ ã€Œå±±ç”°å¤ªéƒã€ ã§ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('name', isNotEqualTo: 'å±±ç”°å¤ªéƒ').get();
```

## isLessThanï¼ˆã€œã‚ˆã‚Šå°ã•ã„ï¼‰

```dart:ã€Œageã€ ãŒ 20 ã‚ˆã‚Šå°ã•ã„ï¼ˆ 20 ã®å ´åˆã¯å«ã¾ãªã„ï¼‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('age', isLessThan: 20).get();
```

## isLessThanOrEqualToï¼ˆã€œä»¥ä¸‹ï¼‰

```dart:ã€Œageã€ ãŒ 20 ä»¥ä¸‹ï¼ˆ 20 ã®å ´åˆã‚’å«ã‚€ï¼‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('age', isLessThanOrEqualTo: 20).get();
```

## isGreaterThanï¼ˆã€œã‚ˆã‚Šå¤§ãã„ï¼‰

```dart:ã€Œageã€ ãŒ 20 ã‚ˆã‚Šå¤§ãã„ï¼ˆ 20 ã®å ´åˆã¯å«ã¾ãªã„ï¼‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('age', isGreaterThan: 20).get();
```

## isGreaterThanOrEqualToï¼ˆã€œä»¥ä¸Šï¼‰

```dart:ã€Œageã€ ãŒ 20 ä»¥ä¸Šï¼ˆ 20 ã®å ´åˆã‚’å«ã‚€ï¼‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('age', isGreaterThanOrEqualTo: 20).get();
```

## arrayContainsï¼ˆé…åˆ—å†…ã«å³è¾ºã®è¦ç´ ã‚’å«ã‚€ï¼‰

```dart:é…åˆ— ã€Œhobbiesã€ ã« ã€Œé‡£ã‚Šã€ ã‚’å«ã‚€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('hobbies', arrayContains: 'é‡£ã‚Š').get();
```

## arrayContainsAnyï¼ˆé…åˆ—å†…ã«å³è¾ºã®è¦ç´ ã®ã„ãšã‚Œã‹ã‚’å«ã‚€ï¼‰

```dart:é…åˆ— ã€Œhobbiesã€ ã« ã€Œé‡£ã‚Šã€ ã€ ã€Œã‚®ã‚¿ãƒ¼ã€ ã®ã„ãšã‚Œã‹ã‚’å«ã‚€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('hobbies', arrayContainsAny: ['é‡£ã‚Š', 'ã‚®ã‚¿ãƒ¼']).get();
```

## whereInï¼ˆå³è¾ºã®ã„ãšã‚Œã‹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ï¼‰

```dart:ã€Œnameã€ ãŒ ã€Œå±±ç”°å¤ªéƒã€ ã€ ã€Œå±±ç”°èŠ±å­ã€ ã®ã„ãšã‚Œã‹ã§ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('name', whereIn: ['å±±ç”°å¤ªéƒ', 'å±±ç”°èŠ±å­']).get();
```

## whereNotInï¼ˆå³è¾ºã®ã„ãšã‚Œã‚‚å«ã¾ã‚Œãªã„ï¼‰

```dart:ã€Œnameã€ ãŒ ã€Œå±±ç”°å¤ªéƒã€ ã€ ã€Œå±±ç”°èŠ±å­ã€ ã®ã„ãšã‚Œã§ã‚‚ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('name', whereNotIn: ['å±±ç”°å¤ªéƒ', 'å±±ç”°èŠ±å­']).get();
```

## isNullï¼ˆå³è¾ºãŒ null ã§ã‚ã‚‹ãƒ»ãªã„ï¼‰

```dart:ã€Œnameã€ ãŒnullã§ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
final _store = FirebaseFirestore.instance;
await _store.collection('users').where('name', isNull: true).get();
```

# orderByï¼ˆç‰¹å®šã®æ¡ä»¶ã§ä¸¦ã¹æ›¿ãˆã‚‹ï¼‰

## æ˜‡é †ã§å–å¾—

```dart:ã€Œageã€ ãŒå°ã•ã„é †ã«å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').orderBy('age', descending: false).get();
```

## é™é †ã§å–å¾—

```dart:ã€Œageã€ ãŒå¤§ãã„é †ã«å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').orderBy('age', descending: true).get();
```

# start, endï¼ˆå–å¾—ç¯„å›²ã®æŒ‡å®šï¼‰

- **ã€‡ã€‡ At** ... ãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã€Œå«ã‚€ã€ï¼ˆ`startAt`, `endAt`ç­‰ï¼‰
- **ã€‡ã€‡ After, ã€‡ã€‡ Before** ... ãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã€Œå«ã¾ãªã„ã€ ï¼ˆ`startAfter`, `endBefore`ç­‰ï¼‰

## startAtï¼ˆç‰¹å®šæ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»¥é™ã‚’å–å¾—ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€dateTime ã«åˆè‡´ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»¥é™ï¼ˆãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å«ã‚€ï¼‰ã‚’å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').orderBy('createdAt', descending: true).startAt([Timestamp.fromDate(dateTime)]).get();
```

## endAtï¼ˆç‰¹å®šæ¡ä»¶ã«åˆã†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¾ã§ã‚’èª­ã¿è¾¼ã‚€ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€dateTime ã«åˆè‡´ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¾ã§ï¼ˆãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å«ã‚€ï¼‰ã‚’å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').orderBy('createdAt', descending: true).endAt([Timestamp.fromDate(dateTime)]).get();
```

## startAfterï¼ˆç‰¹å®šæ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚Šå¾Œã‚ã‚’å–å¾—ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€dateTime ã«åˆè‡´ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»¥é™ï¼ˆãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å«ã¾ãªã„ï¼‰ã‚’å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').orderBy('createdAt', descending: true).startAfter([Timestamp.fromDate(dateTime)]).get();
```

## endBeforeï¼ˆç‰¹å®šæ¡ä»¶ã«åˆã†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›´å‰ã¾ã§ã‚’èª­ã¿è¾¼ã‚€ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€dateTime ã«åˆè‡´ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¾ã§ï¼ˆãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å«ã¾ãªã„ï¼‰ã‚’å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').orderBy('createdAt', descending: true).endBefore([Timestamp.fromDate(dateTime)]).get();
```

## startAtDocumentï¼ˆç‰¹å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»¥é™ã‚’å–å¾—ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€startPointDoc ä»¥é™ï¼ˆ startPointDoc ã‚’å«ã‚€ï¼‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€
final startPointDoc = await _store.collection('users').doc(id).get();
await _store.collection('users').orderBy('createdAt', descending: true).startAtDocument(startPointDoc).get();
```

## endAtDocumentï¼ˆç‰¹å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¾ã§ã‚’èª­ã¿è¾¼ã‚€ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€endPointDoc ã¾ã§ï¼ˆ endPointDoc ã‚’å«ã‚€ï¼‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€
final endPointDoc = await _store.collection('users').doc(id).get();
await _store.collection('users').orderBy('createdAt', descending: true).endAtDocument(endPointDoc).get();
```

## startAfterDocumentï¼ˆç‰¹å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚Šå¾Œã‚ã‚’èª­ã¿è¾¼ã‚€ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€previousDoc ã‚ˆã‚Šå¾Œã‚ï¼ˆ previousDoc ã¯å«ã¾ãªã„ï¼‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€
final previousDoc = await _store.collection('users').doc(id).get();
await _store.collection('users').orderBy('createdAt', descending: true).startAfterDocument(previousDoc).get();
```

## endBeforeDocumentï¼ˆç‰¹å®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›´å‰ã¾ã§ã‚’èª­ã¿è¾¼ã‚€ï¼‰

```dart:æœ€æ–°é †ã«ä¸¦ã¹æ›¿ãˆã€nextDoc ã®ç›´å‰ã¾ã§ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€
final nextDoc = await _store.collection('users').doc(id).get();
await _store.collection('users').orderBy('createdAt', descending: true).endBeforeDocument(nextDoc).get();
```

# limitï¼ˆå–å¾—æ•°ã®åˆ¶é™ï¼‰

## limitï¼ˆæŒ‡å®šã—ãŸæ•°ã ã‘å–å¾—ã™ã‚‹ï¼‰

```dart:ã€Œusersã€ ã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ 20 å€‹å–å¾—
final _store = FirebaseFirestore.instance;
await _store.collection('users').limit(20).get();
```

## limitToLastï¼ˆä¸¦ã¹æ›¿ãˆãŸæ™‚ã®ã€Œæœ€å¾Œã®è¦ç´ ã€ã‹ã‚‰æŒ‡å®šã—ãŸæ•°ã ã‘å–å¾—ã™ã‚‹ï¼‰

```dart:ã€Œusersã€ã‚’è‹¥ã„é †ã«ä¸¦ã¹ãŸæ™‚ã®æœ€é«˜é½¢è€…ã¾ã§ã® 20 å€‹ã‚’å–å¾—ã™ã‚‹
  final _store = FirebaseFirestore.instance;
  await _store.collection('users').orderBy('age').limitToLast(20).get();
```

- limitToLast ã‚¯ã‚¨ãƒªã«ã¯ orderBy å¥ãŒå¿…é ˆã§ã™ï¼ˆã‚‚ã— orderBy ã‚’æŒ‡å®šã—ã¦ã„ãªã„å ´åˆ AssertionError ãŒæŠ•ã’ã‚‰ã‚Œã¾ã™ï¼‰

# count(é›†è¨ˆ)

```dart:ã€Œusersã€ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°ã‚’å–å¾—
final _store = FirebaseFirestore.instance;
final snapshot = await _store.collection('users').count().get();
final usersLength = snapshot.count;
```

# withConverter(å‚ç…§ã‚’ type-safe ã«æ‰±ã†)

```dart:
final usersRef = FirebaseFirestore.instance
    .collection('users')
    .withConverter(
        fromFirestore: (snap, _) => User.fromJson(snap.data()!),
        toFirestore: (user, _) => user.toJson(),
    );
final snap = await usersRef.get();
final List<User> users = snap.docs.map((doc) => doc.data()).toList();
```

# å‚è€ƒ

https://firebase.flutter.dev/docs/firestore/usage/#querying

https://zenn.dev/tentel/articles/ea7d5c03e68e6d142d98
